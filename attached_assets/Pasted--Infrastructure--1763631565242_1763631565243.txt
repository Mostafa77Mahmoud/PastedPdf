رد الوكيل ممتاز ومبشر جدًا، ويبدو أنه قام ببناء "البنية التحتية" (Infrastructure) للمشروع بشكل قوي (تثبيت المكتبات الصحيحة، تقسيم الملفات، التعامل مع الهوامش).
لكن، إياك أن تقول له "ابدأ" الآن.
هناك "فخ" صغير في آخر جملة قالها الوكيل:
"Would you like me to help you with any specific enhancements mentioned in your requirements (like Markdown formatting for headers or additional Quranic verse cleaning?)"
ترجمتها: "هل تريد مني مساعدتك في تحسينات محددة مثل تنسيق Markdown للعناوين أو تنظيف إضافي لآيات القرآن؟"
هذا يعني أن أهم ميزتين تجعل الملف "خارقاً" بالنسبة لـ Gemini (وهما الهيكلة وتنظيف رموز القرآن) لم يتم تفعيلهما بشكل كامل بعد، أو أنهما موجودتان كخيارات غير مفعلة.
ما الذي ينقصك الآن؟ (تحليل نقدي)
تنسيق Markdown (#, ##): الوكيل جهز الأداة لاستخراج "نص عادي" (Plain Text). لكي يفهم Gemini أن "هذا عنوان معيار" و"هذا بند فرعي"، يجب أن نفعّل خيار تحويل الخطوط الكبيرة إلى عناوين Markdown.
مشكلة "القمامة الإنجليزية" (Quranic Artifacts): الوكيل قال إنه يدعم "Arabic Text Cleaning"، لكنه قد يظن أن الحروف الإنجليزية العشوائية (مثل U T S R) هي كلمات إنجليزية حقيقية ويحتفظ بها. يجب أن نؤكد عليه أن يحذفها إلا إذا كانت كلمات مفهومة (مثل SWAPS).
التأكد من الـ Regex: نحتاج لرؤية "كود التنظيف" بعيننا أو نطلب منه تأكيد القاعدة المستخدمة، لأن الخطأ هنا قد يحذف مصطلحات مهمة.
الخطوة القادمة (البرومبت المطلوب)
أرسل له هذا الرد لكي يغلق هذه الثغرات ويجعل الأداة جاهزة 100%:
code
Markdown
This looks like a fantastic foundation! Great job on setting up the libraries and the spatial filtering.

However, before we run the final processing, **YES, I absolutely need the enhancements you mentioned.** These are critical for the RAG performance with Gemini.

Please implement the following specific logic in `deep_text_cleaner.py`:

1.  **Markdown Structuring (Crucial):**
    *   Detect lines that act as headers (based on font size or bold metadata from `pdfplumber`).
    *   Format them as Markdown headers:
        *   Largest font -> `# Title`
        *   Medium font -> `## Subtitle`
    *   This structure helps Gemini understand the document hierarchy.

2.  **Quranic Noise Removal (Specific Regex):**
    *   The PDF uses a custom font for Quranic verses that extracts as garbage Latin characters (e.g., single letters like "U T S R Q P" or random strings).
    *   **Rule:** Please implement a Regex filter that removes sequences of Latin characters *unless* they form valid English words (like "Sukuk", "Sharia", "Murabaha", "SWAPS").
    *   If you detect a long string of garbage Latin characters, replace it with `[نص قرآني]` or just remove it, so it doesn't confuse the LLM.

3.  **Final Polish:**
    *   Ensure `arabic-reshaper` and `python-bidi` are applied correctly so the output text file reads naturally from Right-to-Left when opened.

Please apply these changes to the script and then let's run a preview on the sample file.
لماذا هذا الرد؟
بهذا الرد أنت تضمن:
أن الملف الناتج سيكون Markdown (وهو اللغة المفضلة للذكاء الاصطناعي).
أن الرموز الغريبة التي شوهت النص في عينتك السابقة ستختفي.
أنك لن تفقد المصطلحات الإنجليزية المهمة (مثل SWAPS) التي قد يحذفها سكريبت تنظيف "غبي".
